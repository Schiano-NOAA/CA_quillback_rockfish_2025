# Tables {#sec-tables}


```{r} 
#| label: 'set-rda-dir-tbls'
#| echo: false 
#| warning: false 
#| eval: true 
#| include: false
#library(flextable)
#rda_dir <- here::here("documents", "rda_files")
library(tidyr)
library(gt)
library(here)
``` 


## Data

```{r}
#| label: tbl-catches
#| echo: false
#| warning: false
#| tbl-cap: "Total removals (mt) of quillback rockfish in California for the commercial (Com) and recreational (Rec) fleets as used in the assessment model. See text for description of sources."

catches <- read.csv(here::here("data", "CAquillback_total_removals.csv"), check.names = FALSE) |>
  dplyr::select(c(Year, com_tot, rec_tot))
catches[is.na(catches)] <- 0
catches |>
  gt() |>
  cols_label(
    Year = "Year",
    com_tot = "Commercial",
    rec_tot = "Recreational") |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE) |>
  as_latex()
```

{{< pagebreak >}}

```{r}
#| label: tbl-comm_lengths
#| echo: false
#| warning: false
#| tbl-cap: "Summary of the number of commercial length samples and number of trips available for use in the stock assessment. Also included in the input sample size used in the assessment following the formula described in the text."

commlengths <- read.csv(here::here('data', "SampleSize_length.csv"), check.names = FALSE) |>
  dplyr::select(c(Year, pacfin_Nfish, pacfin_Ntrip)) |>
  dplyr::mutate(pacfin_Ninput = 
                  ifelse(pacfin_Nfish/pacfin_Ntrip < 44, 
                         pacfin_Ntrip + 0.138 * pacfin_Nfish,
                         7.06 * pacfin_Ntrip)) |>
  dplyr::filter(!is.na(pacfin_Ninput))
commlengths|>
  gt() |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
cols_label(
    Year = "Year",
    pacfin_Nfish = "N Lengths",
    pacfin_Ntrip = "N Trips",
    pacfin_Ninput = "N Input"
  ) |>
  as_latex()
```

{{< pagebreak >}}

```{r}
#| label: tbl-comm_ages
#| echo: false
#| warning: false
#| tbl-cap: "Summary of the number of commercial age samples and number of trips available for use in the stock assessment."

commages <- read.csv(here::here('data', "SampleSize_age.csv"), check.names = FALSE) |>
  dplyr::select(c(Year, pacfin_Nfish, pacfin_Ntrip)) |>
  dplyr::filter(!is.na(pacfin_Nfish))
commages|>
  gt() |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
 cols_label(
    Year = "Year",
    pacfin_Nfish = "N Ages",
    pacfin_Ntrip = "N Trips"
  ) |>
  as_latex()
```

{{< pagebreak >}}

```{r}
#| label: tbl-rec_lengths
#| echo: false
#| warning: false
#| tbl-cap: "Summary of the number of recreational length samples and number of trips available for use in the stock assessment. Duplicate PC mode lengths from the MRFSS sampling program in 1997-1998 are not included."

reclengths <- read.csv(here::here('data', "SampleSize_length.csv"), check.names = FALSE) 
reclengths <- reclengths |> 
  dplyr::mutate(tot_Nfish = rowSums(reclengths[,c("recfin_Nfish", "mrfss_Nfish", "deb_Nfish", "GeiCol_Nfish", "MilGei_Nfish", "MilGot_Nfish")], na.rm = TRUE)) |>
  dplyr::mutate(tot_Ntrip = rowSums(reclengths[,c("recfin_Ntrip", "mrfss_Ntrip", "deb_Ntrip", "GeiCol_Ntrip", "MilGei_Ntrip", "MilGot_Ntrip")], na.rm = TRUE)) |> 
  dplyr::select(c(Year, tot_Nfish, tot_Ntrip)) |>
  dplyr::filter(tot_Nfish!=0)
reclengths |>
  gt() |>
  tab_options(
    table.font.size = 11,
    latex.use_longtable = TRUE
  ) |>
cols_label(
    Year = "Year",
    tot_Nfish = "N Lengths",
    tot_Ntrip = "N Trips"
  ) |>
  as_latex()
```

### Fishery-dependent data

{{< pagebreak >}}





## Model results

```{r}
#| label: tbl-model-config
#| warning: false
#| echo: false
#| tbl-cap: !expr if(eval_tables) config_cap

config_table |>
  gt() |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()
```



```{r}
#| label: tbl-n-param
#| warning: false
#| echo: false
#| tbl-cap: !expr if(eval_tables) parcount_cap

parcount_table |>
  dplyr::filter(Count > 0) |>
  gt() |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()
```

::: {.landscape}

```{r}
#| label: tbl-pars
#| warning: false
#| echo: false
#| tbl-cap: !expr if(eval_tables) pars_cap

pars_table |>
  mutate(SD = ifelse(Status == 'fixed', NA, SD)) |>
  gt() |>
  sub_missing(missing_text = '') |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()
```
:::

```{r}
#| label: tbl-compweight
#| warning: false
#| echo: false
#| tbl-cap: !expr if(eval_tables) compweight_cap

compweight_table |>
  gt() |>
  tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE
  ) |>
  as_latex()
```

```{r, results = "asis"}
#| label: tbl-ts
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) time_series_cap 
#| tbl-pos: H

time_series_table |>
kableExtra::kable(
  format = "latex", 
  longtable = TRUE,
  booktabs = TRUE,
  caption = "Time series of population estimates from the base model.",
  linesep = "") |>
  kableExtra::kable_styling(
    latex_options = "repeat_header",
    font_size = 8) |>
  kableExtra::column_spec(
    column = 1:9,
    width = "0.5in"
  )
```

## Management

\pagebreak

::: {.landscape}

```{r, results = "asis"}
#| label: tbl-projections
#| warning: false
#| echo: false
#| eval: !expr eval_tables 
#| tbl-cap: !expr if(eval_tables) projections_cap 
#| tbl-pos: H

projections_table |>
  gt::gt() |>
  gt::fmt_number(
    columns = c(2:5, 7:9),
    decimals = 0
  ) |>
  gt::fmt_number(
    columns = c(6, 10),
    decimals = 3
  ) |>
  gt::tab_options(
    table.font.size = 12,
    latex.use_longtable = TRUE 
  ) |>
  gt::sub_missing(
    columns = tidyselect::everything(),
    missing_text = "---"
  ) |>
  gt::cols_align(
    align = "center"
  ) |>
  gt::cols_width(
    tidyselect::everything() ~ px(75)
  ) |>
  gt::as_latex()

```

:::

